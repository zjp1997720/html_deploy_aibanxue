---
alwaysApply: true
description: "html_deploy项目开发与运行的核心指南"
---

# html_deploy 项目开发与运行指南

- 启动命令：
  - `npm install` 安装依赖
  - `npm run dev` 启动开发服务器（端口 5678）
  - `npm start` 启动生产服务器（端口 8888）
- 架构：Express.js + SQLite + EJS
- 核心组件：
  - [app.js](mdc:app.js)：主入口及中间件
  - [models/db.js](mdc:models/db.js)、[models/pages.js](mdc:models/pages.js)：数据库
  - [routes/pages.js](mdc:routes/pages.js)：API 路由
  - [utils/codeDetector.js](mdc:utils/codeDetector.js)：内容类型检测
  - [utils/contentRenderer.js](mdc:utils/contentRenderer.js)：内容渲染
  - [middleware/auth.js](mdc:middleware/auth.js)：认证
- 内容处理流程：检测 → 存储 → 渲染 → 交付
- 主要 API：
  - GET /view/:id
  - GET /api/pages/:id
  - POST /validate-password/:id
  - POST /api/pages/create
  - GET /api/pages/list/recent
  - GET /admin/dashboard
- 认证方式：Web 会话（/login + cookie）、API Token（Bearer）
- 主要环境变量：NODE_ENV、PORT、AUTH_ENABLED、AUTH_PASSWORD、API_TOKEN、DB_PATH
- 数据库文件：./db/html-go.db（自动创建）
- 会话存储：./sessions/（文件存储，24小时过期）
- 迁移脚本：scripts/migrate-db.js、scripts/add-code-type.js
- 常见内容类型：HTML、Markdown、SVG、Mermaid
- 调试与常见问题：端口冲突、数据库/会话目录权限、内容渲染、详细日志
- 数据库表结构：pages（id, html_content, created_at, password, is_protected, code_type）

<% 
// è®¾ç½®é¡µé¢æ•°æ®
const currentPath = '/admin/pages';
const title = 'é¡µé¢ç®¡ç†';
const breadcrumb = [
    { title: 'ç®¡ç†åå°', url: '/admin/dashboard' },
    { title: 'é¡µé¢ç®¡ç†' }
];
%>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - HTML-GO ç®¡ç†åå°</title>
    <!-- è®¾è®¡ç³»ç»Ÿä¸ç»„ä»¶åº“æ ·å¼ï¼ˆç»Ÿä¸€è§†è§‰ä¸8pxç½‘æ ¼ï¼‰ -->
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="icon" href="/icon/web/favicon.ico">
</head>
<body class="admin-body">
    <div class="admin-layout">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav class="top-nav">
            <div class="nav-left">
                <div class="nav-brand">
                    <span class="brand-icon">ğŸš€</span>
                    <span class="brand-text">HTML-GO Admin</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <span class="toggle-icon">â˜°</span>
                </button>
            </div>
            <div class="nav-right">
                <div class="user-menu">
                    <span class="user-icon">ğŸ‘¤</span>
                    <span class="user-name">ç®¡ç†å‘˜</span>
                </div>
            </div>
        </nav>

        <!-- ä¾§è¾¹å¯¼èˆªæ  -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <nav class="sidebar-nav">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="/admin/dashboard" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                <span class="nav-text">æ¦‚è§ˆ</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/pages" class="nav-link active">
                                <span class="nav-icon">ğŸ“„</span>
                                <span class="nav-text">é¡µé¢ç®¡ç†</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/apikeys" class="nav-link">
                                <span class="nav-icon">ğŸ”‘</span>
                                <span class="nav-text">API Keyç®¡ç†</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/settings" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                <span class="nav-text">ç³»ç»Ÿè®¾ç½®</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <div class="sidebar-footer">
                    <a href="/" class="btn btn-sm btn-outline">ğŸŒ å‰å°</a>
                    <a href="/admin/pages/new" class="btn btn-sm btn-primary">â• æ–°å»º</a>
                </div>
            </div>
        </aside>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- é¢åŒ…å±‘å¯¼èˆª -->
            <div class="breadcrumb-container">
                <nav class="breadcrumb" aria-label="é¢åŒ…å±‘">
                    <a href="/admin/dashboard" class="breadcrumb-link">ç®¡ç†åå°</a>
                    <span class="breadcrumb-separator" aria-hidden="true">/</span>
                    <span class="breadcrumb-current" aria-current="page">é¡µé¢ç®¡ç†</span>
                </nav>
            </div>

            <!-- é¡µé¢å†…å®¹ -->
            <div class="page-content">
                <div class="page-header">
  <div class="page-header-content">
    <h1 class="page-title">
      <i class="fas fa-file-alt"></i>
      é¡µé¢ç®¡ç†
    </h1>
    <p class="page-description">
      ç®¡ç†æ‰€æœ‰å·²åˆ›å»ºçš„é¡µé¢ï¼Œæ”¯æŒæœç´¢ã€ç­›é€‰ã€ç¼–è¾‘å’Œæ‰¹é‡æ“ä½œ
    </p>
  </div>
  <div class="page-actions">
    <button class="btn btn-primary" onclick="window.open('/', '_blank')">
      <i class="fas fa-plus"></i>
      åˆ›å»ºæ–°é¡µé¢
    </button>
  </div>
</div>

<!-- ç»Ÿè®¡æ¦‚è§ˆ - è®¾è®¡å¸ˆé‡æ„ç‰ˆæœ¬ -->
<div class="stats-overview mb-6">
  <div class="stats-container card" role="status" aria-live="polite">
    <div class="stat-item">
      <div class="stat-icon bg-blue-gradient">
        <i class="fas fa-file-alt"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value" id="totalPages">--</span>
        <span class="stat-label">æ€»é¡µé¢æ•°</span>
      </div>
    </div>
    
    <div class="stat-divider"></div>
    
    <div class="stat-item">
      <div class="stat-icon bg-green-gradient">
        <i class="fas fa-globe"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value" id="publicPages">--</span>
        <span class="stat-label">å…¬å¼€é¡µé¢</span>
      </div>
    </div>
    
    <div class="stat-divider"></div>
    
    <div class="stat-item">
      <div class="stat-icon bg-orange-gradient">
        <i class="fas fa-lock"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value" id="protectedPages">--</span>
        <span class="stat-label">å—ä¿æŠ¤é¡µé¢</span>
      </div>
    </div>
    
    <div class="stat-divider"></div>
    
    <div class="stat-item">
      <div class="stat-icon bg-purple-gradient">
        <i class="fas fa-calendar-day"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value" id="todayPages">--</span>
        <span class="stat-label">ä»Šæ—¥æ–°å¢</span>
      </div>
    </div>
  </div>
</div>

<!-- æœç´¢å’Œç­›é€‰ -->
<div class="filter-section">
  <div class="filter-card card">
    <div class="filter-header">
      <h3>æœç´¢å’Œç­›é€‰</h3>
      <button class="btn btn-sm btn-secondary" onclick="resetFilters()">
        <i class="fas fa-undo"></i>
        é‡ç½®
      </button>
    </div>
    
    <div class="filter-content">
      <div class="filter-row" role="group" aria-label="æœç´¢ä¸ç­›é€‰æ¡ä»¶">
        <div class="filter-group">
          <label class="filter-label">æœç´¢å…³é”®è¯</label>
          <input type="text" id="searchInput" class="form-input" 
                 placeholder="æœç´¢é¡µé¢åç§°æˆ–å†…å®¹..." aria-label="æœç´¢å…³é”®è¯" onchange="applyFilters()">
        </div>
        
        <div class="filter-group">
          <label class="filter-label">å†…å®¹ç±»å‹</label>
          <select id="codeTypeFilter" class="form-input" onchange="applyFilters()" aria-label="å†…å®¹ç±»å‹">
            <option value="">å…¨éƒ¨ç±»å‹</option>
            <option value="html">HTML</option>
            <option value="markdown">Markdown</option>
            <option value="svg">SVG</option>
            <option value="mermaid">Mermaid</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label">ä¿æŠ¤çŠ¶æ€</label>
          <select id="protectionFilter" class="form-input" onchange="applyFilters()" aria-label="ä¿æŠ¤çŠ¶æ€">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option value="false">å…¬å¼€</option>
            <option value="true">å—ä¿æŠ¤</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label">æ’åºæ–¹å¼</label>
          <select id="sortFilter" class="form-input" onchange="applyFilters()" aria-label="æ’åºæ–¹å¼">
            <option value="created_at,DESC">åˆ›å»ºæ—¶é—´ï¼ˆæœ€æ–°ï¼‰</option>
            <option value="created_at,ASC">åˆ›å»ºæ—¶é—´ï¼ˆæœ€æ—©ï¼‰</option>
            <option value="name,ASC">åç§°ï¼ˆA-Zï¼‰</option>
            <option value="name,DESC">åç§°ï¼ˆZ-Aï¼‰</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- é¡µé¢åˆ—è¡¨ -->
<div class="data-card card">
  <div class="data-card-header card-header">
    <h2 class="data-card-title">
      <i class="fas fa-list"></i>
      é¡µé¢åˆ—è¡¨
      <span id="pageCount" class="page-count"></span>
    </h2>
    <div class="data-card-actions">
      <div class="batch-actions" id="batchActions" style="display: none;">
        <button class="btn btn-sm btn-danger" onclick="batchDelete()">
          <i class="fas fa-trash"></i>
          æ‰¹é‡åˆ é™¤
        </button>
        <button class="btn btn-sm btn-warning" onclick="batchProtect(true)">
          <i class="fas fa-lock"></i>
          è®¾ä¸ºä¿æŠ¤
        </button>
        <button class="btn btn-sm btn-success" onclick="batchProtect(false)">
          <i class="fas fa-unlock"></i>
          å–æ¶ˆä¿æŠ¤
        </button>
        <span class="selected-count" id="selectedCount">å·²é€‰æ‹© 0 é¡¹</span>
      </div>
      <button class="btn btn-sm btn-secondary" onclick="refreshPageList()">
        <i class="fas fa-sync-alt"></i>
        åˆ·æ–°
      </button>
    </div>
  </div>
  
  <div class="data-card-content card-body">
    <div id="loadingSpinner" class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      åŠ è½½ä¸­...
    </div>
    
    <div id="pageListContainer" style="display: none;">
      <div class="table-responsive table-container">
        <table class="data-table" role="table" aria-label="é¡µé¢åˆ—è¡¨">
          <thead>
            <tr>
              <th>
                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
              </th>
              <th>é¡µé¢ä¿¡æ¯</th>
              <th>ç±»å‹</th>
              <th>çŠ¶æ€</th>
              <th>å†…å®¹å¤§å°</th>
              <th>åˆ›å»ºæ—¶é—´</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="pageListBody">
            <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
          </tbody>
        </table>
      </div>
      
      <!-- åˆ†é¡µç»„ä»¶ -->
      <div id="paginationContainer" class="pagination-container">
        <!-- åˆ†é¡µå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </div>
      
      <div id="emptyState" class="empty-state" style="display: none;">
        <i class="fas fa-file-alt empty-icon"></i>
        <h3>æ²¡æœ‰æ‰¾åˆ°é¡µé¢</h3>
        <p>å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–åˆ›å»ºæ–°çš„é¡µé¢</p>
        <button class="btn btn-primary" onclick="window.open('/', '_blank')">
          <i class="fas fa-plus"></i>
          åˆ›å»ºæ–°é¡µé¢
        </button>
      </div>
    </div>
  </div>
</div>

<!-- é¡µé¢ç¼–è¾‘æ¨¡æ€æ¡† - è®¾è®¡å¸ˆé‡æ„ç‰ˆæœ¬ -->
<div id="editModal" class="modal modal-enhanced" role="dialog" aria-modal="true" aria-labelledby="editModalTitle">
  <div class="modal-content modal-large-enhanced">
    <div class="modal-header modal-header-enhanced">
      <div class="modal-title-section">
        <div class="modal-icon">
          <i class="fas fa-edit"></i>
        </div>
        <div class="modal-title-content">
          <h3 class="modal-title" id="editModalTitle">ç¼–è¾‘é¡µé¢</h3>
          <p class="modal-subtitle">ä¿®æ”¹é¡µé¢å†…å®¹å’Œè®¾ç½®</p>
        </div>
      </div>
      <button class="modal-close modal-close-enhanced" onclick="hideEditModal()" aria-label="å…³é—­å¯¹è¯æ¡†">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body modal-body-enhanced">
      <form id="editPageForm" class="form-enhanced">
        <input type="hidden" id="editPageId" name="pageId">
        
        <!-- åŸºæœ¬ä¿¡æ¯åŒºåŸŸ -->
        <div class="form-section">
          <div class="section-header">
            <h4 class="section-title">
              <i class="fas fa-info-circle"></i>
              åŸºæœ¬ä¿¡æ¯
            </h4>
          </div>
          <div class="section-content">
            <div class="form-group form-group-enhanced">
              <label for="editPageName" class="form-label">
                <span class="label-text">é¡µé¢åç§°</span>
              </label>
              <input type="text" id="editPageName" name="name" class="form-input form-input-enhanced" 
                     placeholder="ç»™é¡µé¢èµ·ä¸€ä¸ªåç§°ï¼ˆå¯é€‰ï¼‰">
              <div class="form-feedback" id="editPageNameFeedback"></div>
              <small class="form-help">ä¾¿äºè¯†åˆ«å’Œç®¡ç†çš„é¡µé¢åç§°</small>
            </div>
            
            <div class="form-row-enhanced">
              <div class="form-group form-group-enhanced">
                <label for="editCodeType" class="form-label">
                  <span class="label-text">å†…å®¹ç±»å‹</span>
                </label>
                <div class="content-type-selector">
                  <div class="type-option" data-value="html">
                    <div class="type-icon html-icon">
                      <i class="fab fa-html5"></i>
                    </div>
                    <div class="type-info">
                      <div class="type-title">HTML</div>
                      <div class="type-desc">å¯Œæ–‡æœ¬ç½‘é¡µ</div>
                    </div>
                    <div class="type-check">
                      <i class="fas fa-check"></i>
                    </div>
                  </div>
                  
                  <div class="type-option" data-value="markdown">
                    <div class="type-icon markdown-icon">
                      <i class="fab fa-markdown"></i>
                    </div>
                    <div class="type-info">
                      <div class="type-title">Markdown</div>
                      <div class="type-desc">è½»é‡æ ‡è®°è¯­è¨€</div>
                    </div>
                    <div class="type-check">
                      <i class="fas fa-check"></i>
                    </div>
                  </div>
                  
                  <div class="type-option" data-value="svg">
                    <div class="type-icon svg-icon">
                      <i class="fas fa-vector-square"></i>
                    </div>
                    <div class="type-info">
                      <div class="type-title">SVG</div>
                      <div class="type-desc">çŸ¢é‡å›¾å½¢</div>
                    </div>
                    <div class="type-check">
                      <i class="fas fa-check"></i>
                    </div>
                  </div>
                  
                  <div class="type-option" data-value="mermaid">
                    <div class="type-icon mermaid-icon">
                      <i class="fas fa-project-diagram"></i>
                    </div>
                    <div class="type-info">
                      <div class="type-title">Mermaid</div>
                      <div class="type-desc">æµç¨‹å›¾è¡¨</div>
                    </div>
                    <div class="type-check">
                      <i class="fas fa-check"></i>
                    </div>
                  </div>
                  
                  <input type="hidden" id="editCodeType" name="codeType">
                </div>
                <div class="form-feedback" id="editCodeTypeFeedback"></div>
              </div>
              
              <div class="form-group form-group-enhanced">
                <label class="form-label">
                  <span class="label-text">ä¿æŠ¤è®¾ç½®</span>
                </label>
                <div class="protection-card">
                  <div class="protection-toggle">
                    <label class="toggle-switch">
                      <input type="checkbox" id="editIsProtected" name="isProtected">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                  <div class="protection-info">
                    <h5 class="protection-title">å¯†ç ä¿æŠ¤</h5>
                    <p class="protection-desc">å¯ç”¨åéœ€è¦å¯†ç æ‰èƒ½è®¿é—®</p>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-group form-group-enhanced" id="editPasswordGroup" style="display: none;">
              <label for="editPassword" class="form-label">
                <span class="label-text">è®¿é—®å¯†ç </span>
              </label>
              <div class="password-input-wrapper">
                <input type="text" id="editPassword" name="password" class="form-input form-input-enhanced" 
                       placeholder="5ä½æ•°å­—å¯†ç " maxlength="5" pattern="[0-9]{5}">
                <div class="password-strength" id="passwordStrength"></div>
              </div>
              <div class="form-feedback" id="editPasswordFeedback"></div>
              <small class="form-help">è¯·è¾“å…¥5ä½æ•°å­—å¯†ç </small>
            </div>
          </div>
        </div>

        <!-- å†…å®¹ç¼–è¾‘åŒºåŸŸ -->
        <div class="form-section">
          <div class="section-header">
            <h4 class="section-title">
              <i class="fas fa-code"></i>
              é¡µé¢å†…å®¹
            </h4>
            <div class="section-actions">
              <button type="button" class="btn btn-sm btn-outline" onclick="formatContent()">
                <i class="fas fa-magic"></i>
                æ ¼å¼åŒ–
              </button>
              <button type="button" class="btn btn-sm btn-outline" onclick="previewContent()">
                <i class="fas fa-eye"></i>
                é¢„è§ˆ
              </button>
            </div>
          </div>
          <div class="section-content">
            <div class="content-editor-wrapper">
              <div class="editor-toolbar">
                <div class="toolbar-group">
                  <button type="button" class="toolbar-btn" onclick="insertTemplate('html')" title="HTMLæ¨¡æ¿">
                    <i class="fab fa-html5"></i>
                  </button>
                  <button type="button" class="toolbar-btn" onclick="insertTemplate('css')" title="CSSæ ·å¼">
                    <i class="fab fa-css3-alt"></i>
                  </button>
                  <button type="button" class="toolbar-btn" onclick="insertTemplate('js')" title="JavaScript">
                    <i class="fab fa-js-square"></i>
                  </button>
                </div>
                <div class="toolbar-group">
                  <button type="button" class="toolbar-btn" onclick="toggleFullscreen()" title="å…¨å±ç¼–è¾‘">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button type="button" class="toolbar-btn" onclick="toggleLineNumbers()" title="è¡Œå·">
                    <i class="fas fa-list-ol"></i>
                  </button>
                </div>
              </div>
              
              <div class="editor-container">
                <textarea id="editHtmlContent" name="htmlContent" class="form-textarea form-textarea-enhanced" 
                          rows="20" placeholder="åœ¨è¿™é‡Œè¾“å…¥æˆ–ç²˜è´´å†…å®¹..."></textarea>
                <div class="editor-gutter" id="editorGutter"></div>
              </div>
              
              <div class="editor-footer">
                <div class="editor-stats">
                  <span class="stat-item">
                    <i class="fas fa-font"></i>
                    <span id="contentSize">0</span> å­—ç¬¦
                  </span>
                  <span class="stat-item">
                    <i class="fas fa-list"></i>
                    <span id="lineCount">1</span> è¡Œ
                  </span>
                  <span class="stat-item">
                    <i class="fas fa-file-alt"></i>
                    <span id="fileSize">0 B</span>
                  </span>
                </div>
                <div class="editor-actions">
                  <button type="button" class="btn btn-sm btn-ghost" onclick="clearContent()">
                    <i class="fas fa-trash"></i>
                    æ¸…ç©º
                  </button>
                  <button type="button" class="btn btn-sm btn-ghost" onclick="copyContent()">
                    <i class="fas fa-copy"></i>
                    å¤åˆ¶
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer modal-footer-enhanced">
      <button type="button" class="btn btn-secondary btn-enhanced" onclick="hideEditModal()">
        <i class="fas fa-times"></i>
        å–æ¶ˆ
      </button>
      <button type="button" class="btn btn-primary btn-enhanced btn-loading-capable" onclick="savePageChanges()" id="savePageBtn">
        <span class="btn-content">
          <i class="fas fa-save"></i>
          ä¿å­˜æ›´æ”¹
        </span>
        <span class="btn-loading" style="display: none;">
          <i class="fas fa-spinner fa-spin"></i>
          ä¿å­˜ä¸­...
        </span>
      </button>
    </div>
  </div>
</div>

<!-- é¡µé¢é¢„è§ˆæ¨¡æ€æ¡† -->
<div id="previewModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="previewModalTitle">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h3 class="modal-title" id="previewModalTitle">
        <i class="fas fa-eye"></i>
        é¡µé¢é¢„è§ˆ
      </h3>
      <button class="modal-close" onclick="hidePreviewModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="preview-toolbar">
        <button class="btn btn-sm btn-primary" id="openPageBtn" onclick="openPageInNewTab()">
          <i class="fas fa-external-link-alt"></i>
          åœ¨æ–°çª—å£æ‰“å¼€
        </button>
        <button class="btn btn-sm btn-secondary" onclick="copyPageLink()">
          <i class="fas fa-copy"></i>
          å¤åˆ¶é“¾æ¥
        </button>
      </div>
      <div class="preview-container">
        <iframe id="previewFrame" class="preview-frame" title="é¡µé¢é¢„è§ˆ"></iframe>
      </div>
    </div>
  </div>
</div>

<script>
// é¡µé¢ç®¡ç†ç›¸å…³çš„JavaScriptä»£ç 
let currentPages = [];
let currentPagination = {};
let currentFilters = {
  page: 1,
  limit: 20,
  search: '',
  codeType: '',
  isProtected: null,
  sortBy: 'created_at',
  sortOrder: 'DESC'
};
let selectedPages = new Set();

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  loadPagesStats();
  loadPagesList();
  initEventListeners();
});

// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
function initEventListeners() {
  // æœç´¢è¾“å…¥æ¡†é˜²æŠ–
  let searchTimeout;
  document.getElementById('searchInput').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      applyFilters();
    }, 500);
  });

  // ç¼–è¾‘é¡µé¢è¡¨å•ä¸­çš„å†…å®¹å¤§å°è®¡ç®—
  document.getElementById('editHtmlContent').addEventListener('input', function() {
    document.getElementById('contentSize').textContent = this.value.length;
  });

  // ä¿æŠ¤çŠ¶æ€å¤é€‰æ¡†å˜åŒ–
  document.getElementById('editIsProtected').addEventListener('change', function() {
    const passwordGroup = document.getElementById('editPasswordGroup');
    passwordGroup.style.display = this.checked ? 'block' : 'none';
  });
}

// åŠ è½½é¡µé¢ç»Ÿè®¡ä¿¡æ¯
async function loadPagesStats() {
  try {
    const response = await fetch('/api/admin/pages/stats');
    const data = await response.json();
    
    if (data.success) {
      const stats = data.stats;
      document.getElementById('totalPages').textContent = stats.total;
      document.getElementById('publicPages').textContent = stats.public;
      document.getElementById('protectedPages').textContent = stats.protected;
      document.getElementById('todayPages').textContent = stats.today;
    }
  } catch (error) {
    console.error('åŠ è½½é¡µé¢ç»Ÿè®¡é”™è¯¯:', error);
  }
}

// åŠ è½½é¡µé¢åˆ—è¡¨
async function loadPagesList() {
  try {
    const params = new URLSearchParams(currentFilters);
    const response = await fetch(`/api/admin/pages?${params}`);
    const data = await response.json();
    
    if (data.success) {
      currentPages = data.pages;
      currentPagination = data.pagination;
      renderPagesList();
      renderPagination();
      updatePageCount();
    } else {
      showNotification('åŠ è½½é¡µé¢åˆ—è¡¨å¤±è´¥: ' + data.error, 'error');
    }
  } catch (error) {
    console.error('åŠ è½½é¡µé¢åˆ—è¡¨é”™è¯¯:', error);
    showNotification('åŠ è½½é¡µé¢åˆ—è¡¨å¤±è´¥', 'error');
  } finally {
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('pageListContainer').style.display = 'block';
  }
}

// æ¸²æŸ“é¡µé¢åˆ—è¡¨
function renderPagesList() {
  const tbody = document.getElementById('pageListBody');
  const emptyState = document.getElementById('emptyState');
  
  if (currentPages.length === 0) {
    tbody.innerHTML = '';
    emptyState.style.display = 'block';
    return;
  }
  
  emptyState.style.display = 'none';
  
  tbody.innerHTML = currentPages.map(page => `
    <tr>
      <td>
        <input type="checkbox" class="page-checkbox" value="${page.id}" 
               onchange="togglePageSelection('${page.id}')">
      </td>
      <td>
        <div class="page-info">
          <div class="page-name">
            <strong>${escapeHtml(page.name || `HTML-${page.id}`)}</strong>
            <button class="btn-link" onclick="copyPageLink('${page.id}')" title="å¤åˆ¶é“¾æ¥">
              <i class="fas fa-copy"></i>
            </button>
          </div>
          <div class="page-id">ID: ${page.id}</div>
          ${page.name ? `<div class="page-content-preview">${escapeHtml(page.html_content.substring(0, 100))}...</div>` : ''}
        </div>
      </td>
      <td>
        <span class="type-badge type-${page.code_type}">${page.code_type.toUpperCase()}</span>
      </td>
      <td>
        <span class="status-badge ${page.is_protected ? 'status-protected' : 'status-public'}">
          <i class="fas ${page.is_protected ? 'fa-lock' : 'fa-globe'}"></i>
          ${page.is_protected ? 'å—ä¿æŠ¤' : 'å…¬å¼€'}
        </span>
      </td>
      <td>
        ${formatFileSize(page.content_size)}
      </td>
      <td>
        ${formatDate(page.created_at)}
      </td>
      <td>
        <div class="action-buttons">
          <button class="btn btn-sm btn-info" onclick="previewPage('${page.id}')" title="é¢„è§ˆ">
            <i class="fas fa-eye"></i>
          </button>
          <button class="btn btn-sm btn-secondary" onclick="editPage('${page.id}')" title="ç¼–è¾‘">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" onclick="deletePage('${page.id}')" title="åˆ é™¤">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </td>
    </tr>
  `).join('');
}

// æ¸²æŸ“åˆ†é¡µç»„ä»¶
function renderPagination() {
  const container = document.getElementById('paginationContainer');
  const pagination = currentPagination;
  
  if (pagination.total <= 1) {
    container.innerHTML = '';
    return;
  }
  
  let paginationHtml = '<div class="pagination">';
  
  // ä¸Šä¸€é¡µ
  if (pagination.hasPrev) {
    paginationHtml += `<button class="page-btn" onclick="goToPage(${pagination.current - 1})">
      <i class="fas fa-chevron-left"></i> ä¸Šä¸€é¡µ
    </button>`;
  }
  
  // é¡µç æŒ‰é’®
  const startPage = Math.max(1, pagination.current - 2);
  const endPage = Math.min(pagination.total, pagination.current + 2);
  
  if (startPage > 1) {
    paginationHtml += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
    if (startPage > 2) {
      paginationHtml += '<span class="page-ellipsis">...</span>';
    }
  }
  
  for (let i = startPage; i <= endPage; i++) {
    paginationHtml += `<button class="page-btn ${i === pagination.current ? 'active' : ''}" 
                       onclick="goToPage(${i})">${i}</button>`;
  }
  
  if (endPage < pagination.total) {
    if (endPage < pagination.total - 1) {
      paginationHtml += '<span class="page-ellipsis">...</span>';
    }
    paginationHtml += `<button class="page-btn" onclick="goToPage(${pagination.total})">${pagination.total}</button>`;
  }
  
  // ä¸‹ä¸€é¡µ
  if (pagination.hasNext) {
    paginationHtml += `<button class="page-btn" onclick="goToPage(${pagination.current + 1})">
      ä¸‹ä¸€é¡µ <i class="fas fa-chevron-right"></i>
    </button>`;
  }
  
  paginationHtml += '</div>';
  
  // åˆ†é¡µä¿¡æ¯
  paginationHtml += `<div class="pagination-info">
    æ˜¾ç¤ºç¬¬ ${(pagination.current - 1) * pagination.limit + 1} - 
    ${Math.min(pagination.current * pagination.limit, pagination.totalRecords)} é¡¹ï¼Œ
    å…± ${pagination.totalRecords} é¡¹
  </div>`;
  
  container.innerHTML = paginationHtml;
}

// æ›´æ–°é¡µé¢è®¡æ•°
function updatePageCount() {
  const countElement = document.getElementById('pageCount');
  if (currentPagination.totalRecords > 0) {
    countElement.textContent = `(${currentPagination.totalRecords})`;
  } else {
    countElement.textContent = '';
  }
}

// åº”ç”¨ç­›é€‰æ¡ä»¶
function applyFilters() {
  const search = document.getElementById('searchInput').value.trim();
  const codeType = document.getElementById('codeTypeFilter').value;
  const isProtected = document.getElementById('protectionFilter').value;
  const [sortBy, sortOrder] = document.getElementById('sortFilter').value.split(',');
  
  currentFilters = {
    ...currentFilters,
    page: 1, // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
    search,
    codeType,
    isProtected: isProtected === '' ? null : isProtected,
    sortBy,
    sortOrder
  };
  
  selectedPages.clear();
  updateBatchActions();
  loadPagesList();
}

// é‡ç½®ç­›é€‰æ¡ä»¶
function resetFilters() {
  document.getElementById('searchInput').value = '';
  document.getElementById('codeTypeFilter').value = '';
  document.getElementById('protectionFilter').value = '';
  document.getElementById('sortFilter').value = 'created_at,DESC';
  
  currentFilters = {
    page: 1,
    limit: 20,
    search: '',
    codeType: '',
    isProtected: null,
    sortBy: 'created_at',
    sortOrder: 'DESC'
  };
  
  selectedPages.clear();
  updateBatchActions();
  loadPagesList();
}

// è·³è½¬åˆ°æŒ‡å®šé¡µé¢
function goToPage(page) {
  currentFilters.page = page;
  loadPagesList();
}

// åˆ·æ–°é¡µé¢åˆ—è¡¨
function refreshPageList() {
  document.getElementById('loadingSpinner').style.display = 'block';
  document.getElementById('pageListContainer').style.display = 'none';
  loadPagesStats();
  loadPagesList();
}

// åˆ‡æ¢é¡µé¢é€‰æ‹©
function togglePageSelection(pageId) {
  const checkbox = document.querySelector(`input[value="${pageId}"]`);
  if (checkbox.checked) {
    selectedPages.add(pageId);
  } else {
    selectedPages.delete(pageId);
  }
  updateBatchActions();
}

// å…¨é€‰/å–æ¶ˆå…¨é€‰
function toggleSelectAll() {
  const selectAllCheckbox = document.getElementById('selectAll');
  const pageCheckboxes = document.querySelectorAll('.page-checkbox');
  
  pageCheckboxes.forEach(checkbox => {
    checkbox.checked = selectAllCheckbox.checked;
    if (selectAllCheckbox.checked) {
      selectedPages.add(checkbox.value);
    } else {
      selectedPages.delete(checkbox.value);
    }
  });
  
  updateBatchActions();
}

// æ›´æ–°æ‰¹é‡æ“ä½œæŒ‰é’®
function updateBatchActions() {
  const batchActions = document.getElementById('batchActions');
  const selectedCount = document.getElementById('selectedCount');
  
  if (selectedPages.size > 0) {
    batchActions.style.display = 'flex';
    selectedCount.textContent = `å·²é€‰æ‹© ${selectedPages.size} é¡¹`;
  } else {
    batchActions.style.display = 'none';
  }
}

// é¢„è§ˆé¡µé¢
function previewPage(pageId) {
  const page = currentPages.find(p => p.id === pageId);
  if (!page) return;
  
  const modal = document.getElementById('previewModal');
  const frame = document.getElementById('previewFrame');
  const openBtn = document.getElementById('openPageBtn');
  
  const url = `/view/${pageId}`;
  frame.src = url;
  openBtn.onclick = () => window.open(url, '_blank');
  
  modal.style.display = 'flex';
}

// éšè—é¢„è§ˆæ¨¡æ€æ¡†
function hidePreviewModal() {
  document.getElementById('previewModal').style.display = 'none';
  document.getElementById('previewFrame').src = '';
}

// å†…å®¹ç±»å‹é€‰æ‹©å™¨äº¤äº’
function initContentTypeSelector() {
  const typeOptions = document.querySelectorAll('.type-option');
  const hiddenInput = document.getElementById('editCodeType');
  
  typeOptions.forEach(option => {
    option.addEventListener('click', function() {
      const value = this.dataset.value;
      
      // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
      typeOptions.forEach(opt => opt.classList.remove('selected'));
      
      // æ·»åŠ é€‰ä¸­çŠ¶æ€
      this.classList.add('selected', 'selecting');
      
      // è®¾ç½®éšè—è¾“å…¥æ¡†çš„å€¼
      hiddenInput.value = value;
      
      // ç§»é™¤selectingç±»ï¼ˆç”¨äºåŠ¨ç”»æ•ˆæœï¼‰
      setTimeout(() => {
        this.classList.remove('selecting');
      }, 150);
      
      // è§¦å‘changeäº‹ä»¶
      hiddenInput.dispatchEvent(new Event('change'));
    });
  });
}

// è®¾ç½®å†…å®¹ç±»å‹é€‰æ‹©
function setContentTypeSelection(value) {
  const typeOptions = document.querySelectorAll('.type-option');
  const hiddenInput = document.getElementById('editCodeType');
  
  // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
  typeOptions.forEach(opt => opt.classList.remove('selected'));
  
  // é€‰ä¸­å¯¹åº”çš„é€‰é¡¹
  const targetOption = document.querySelector(`.type-option[data-value="${value}"]`);
  if (targetOption) {
    targetOption.classList.add('selected');
  }
  
  // è®¾ç½®éšè—è¾“å…¥æ¡†çš„å€¼
  hiddenInput.value = value;
}

// ç¼–è¾‘é¡µé¢
function editPage(pageId) {
  const page = currentPages.find(p => p.id === pageId);
  if (!page) return;
  
  // å¡«å……è¡¨å•
  document.getElementById('editPageId').value = page.id;
  document.getElementById('editPageName').value = page.name || '';
  document.getElementById('editIsProtected').checked = page.is_protected === 1;
  document.getElementById('editPassword').value = page.password || '';
  document.getElementById('editHtmlContent').value = page.html_content || '';
  
  // è®¾ç½®å†…å®¹ç±»å‹é€‰æ‹©å™¨
  setContentTypeSelection(page.code_type || 'html');
  
  // æ˜¾ç¤º/éšè—å¯†ç å­—æ®µ
  const passwordGroup = document.getElementById('editPasswordGroup');
  passwordGroup.style.display = page.is_protected === 1 ? 'block' : 'none';
  
  // æ›´æ–°å†…å®¹å¤§å°å’Œè¡Œæ•°ç»Ÿè®¡
  const content = page.html_content || '';
  document.getElementById('contentSize').textContent = content.length;
  document.getElementById('lineCount').textContent = content.split('\n').length;
  document.getElementById('fileSize').textContent = formatFileSize(new Blob([content]).size);
  
  // åˆå§‹åŒ–å†…å®¹ç±»å‹é€‰æ‹©å™¨
  initContentTypeSelector();
  
  document.getElementById('editModal').style.display = 'flex';
}

// éšè—ç¼–è¾‘æ¨¡æ€æ¡†
function hideEditModal() {
  document.getElementById('editModal').style.display = 'none';
  document.getElementById('editPageForm').reset();
}

// ä¿å­˜é¡µé¢æ›´æ”¹
async function savePageChanges() {
  const form = document.getElementById('editPageForm');
  const formData = new FormData(form);
  
  const pageId = formData.get('pageId');
  const updates = {
    name: formData.get('name'),
    codeType: formData.get('codeType'),
    isProtected: document.getElementById('editIsProtected').checked,
    password: formData.get('password'),
    htmlContent: formData.get('htmlContent')
  };
  
  try {
    const response = await fetch(`/api/admin/pages/${pageId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(updates)
    });
    
    const data = await response.json();
    
    if (data.success) {
      showNotification('é¡µé¢æ›´æ–°æˆåŠŸ', 'success');
      hideEditModal();
      refreshPageList();
    } else {
      showNotification('æ›´æ–°å¤±è´¥: ' + data.error, 'error');
    }
  } catch (error) {
    console.error('ä¿å­˜é¡µé¢æ›´æ”¹é”™è¯¯:', error);
    showNotification('ä¿å­˜å¤±è´¥', 'error');
  }
}

// åˆ é™¤å•ä¸ªé¡µé¢
async function deletePage(pageId) {
  const page = currentPages.find(p => p.id === pageId);
  const pageName = page ? (page.name || `HTML-${page.id}`) : pageId;
  
  if (!confirm(`ç¡®å®šè¦åˆ é™¤é¡µé¢"${pageName}"å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`)) {
    return;
  }
  
  try {
    const response = await fetch(`/api/admin/pages/${pageId}`, {
      method: 'DELETE'
    });
    
    const data = await response.json();
    
    if (data.success) {
      showNotification('é¡µé¢åˆ é™¤æˆåŠŸ', 'success');
      refreshPageList();
    } else {
      showNotification('åˆ é™¤å¤±è´¥: ' + data.error, 'error');
    }
  } catch (error) {
    console.error('åˆ é™¤é¡µé¢é”™è¯¯:', error);
    showNotification('åˆ é™¤å¤±è´¥', 'error');
  }
}

// æ‰¹é‡åˆ é™¤é¡µé¢
async function batchDelete() {
  if (selectedPages.size === 0) {
    showNotification('è¯·é€‰æ‹©è¦åˆ é™¤çš„é¡µé¢', 'warning');
    return;
  }
  
  if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedPages.size} ä¸ªé¡µé¢å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`)) {
    return;
  }
  
  try {
    const response = await fetch('/api/admin/pages/batch/delete', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        pageIds: Array.from(selectedPages)
      })
    });
    
    const data = await response.json();
    
    if (data.success) {
      showNotification(data.message, 'success');
      selectedPages.clear();
      updateBatchActions();
      refreshPageList();
    } else {
      showNotification('æ‰¹é‡åˆ é™¤å¤±è´¥: ' + data.error, 'error');
    }
  } catch (error) {
    console.error('æ‰¹é‡åˆ é™¤é”™è¯¯:', error);
    showNotification('æ‰¹é‡åˆ é™¤å¤±è´¥', 'error');
  }
}

// æ‰¹é‡è®¾ç½®ä¿æŠ¤çŠ¶æ€
async function batchProtect(isProtected) {
  if (selectedPages.size === 0) {
    showNotification('è¯·é€‰æ‹©è¦æ“ä½œçš„é¡µé¢', 'warning');
    return;
  }
  
  const action = isProtected ? 'è®¾ä¸ºä¿æŠ¤' : 'å–æ¶ˆä¿æŠ¤';
  if (!confirm(`ç¡®å®šè¦${action}é€‰ä¸­çš„ ${selectedPages.size} ä¸ªé¡µé¢å—ï¼Ÿ`)) {
    return;
  }
  
  try {
    const response = await fetch('/api/admin/pages/batch/protection', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        pageIds: Array.from(selectedPages),
        isProtected
      })
    });
    
    const data = await response.json();
    
    if (data.success) {
      showNotification(data.message, 'success');
      selectedPages.clear();
      updateBatchActions();
      refreshPageList();
    } else {
      showNotification(`æ‰¹é‡${action}å¤±è´¥: ` + data.error, 'error');
    }
  } catch (error) {
    console.error(`æ‰¹é‡${action}é”™è¯¯:`, error);
    showNotification(`æ‰¹é‡${action}å¤±è´¥`, 'error');
  }
}

// å¤åˆ¶é¡µé¢é“¾æ¥
function copyPageLink(pageId) {
  const url = `${window.location.origin}/view/${pageId}`;
  navigator.clipboard.writeText(url).then(() => {
    showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
  }).catch(() => {
    // é™çº§æ–¹æ¡ˆ
    const input = document.createElement('input');
    input.value = url;
    document.body.appendChild(input);
    input.select();
    document.execCommand('copy');
    document.body.removeChild(input);
    showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
  });
}

// åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é¡µé¢
let currentPreviewPageId = null;
function openPageInNewTab() {
  if (currentPreviewPageId) {
    window.open(`/view/${currentPreviewPageId}`, '_blank');
  }
}

// å·¥å…·å‡½æ•°
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function formatDate(timestamp) {
  const date = new Date(parseInt(timestamp));
  return date.toLocaleString('zh-CN');
}

function formatFileSize(size) {
  if (size < 1024) return size + ' B';
  if (size < 1024 * 1024) return (size / 1024).toFixed(1) + ' KB';
  return (size / (1024 * 1024)).toFixed(1) + ' MB';
}

// æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('modal')) {
    e.target.style.display = 'none';
  }
});
</script>

<style>
/* ===== é¡µé¢ç¼–è¾‘å¯¹è¯æ¡†å¢å¼ºæ ·å¼ ===== */
.modal-enhanced {
  background-color: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(8px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-large-enhanced {
  max-width: 1000px;
  width: 95vw;
  max-height: 95vh;
  border-radius: 16px;
  box-shadow: 
    0 25px 50px -12px rgba(0, 0, 0, 0.25),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  overflow: hidden;
  animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* ===== æ¨¡æ€æ¡†å¤´éƒ¨å¢å¼º ===== */
.modal-header-enhanced {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border: none;
}

.modal-title-section {
  display: flex;
  align-items: center;
  gap: 16px;
}

.modal-icon {
  width: 48px;
  height: 48px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.modal-title-content h3 {
  margin: 0;
  font-size: 20px;
  font-weight: 600;
  line-height: 1.2;
}

.modal-subtitle {
  margin: 4px 0 0 0;
  font-size: 14px;
  opacity: 0.9;
  font-weight: 400;
}

.modal-close-enhanced {
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.modal-close-enhanced:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.05);
}

/* ===== è¡¨å•åŒºåŸŸåˆ†ç»„ ===== */
.form-section {
  border-bottom: 1px solid #f1f5f9;
}

.form-section:last-child {
  border-bottom: none;
}

.section-header {
  background: #f8fafc;
  padding: 16px 24px;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.section-title {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: #334155;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-title i {
  color: #667eea;
  font-size: 14px;
}

.section-content {
  padding: 24px;
}

.section-actions {
  display: flex;
  gap: 8px;
}

/* ===== è¡¨å•ç»„ä»¶å¢å¼º ===== */
.form-group-enhanced {
  margin-bottom: 16px;
}

.form-group-enhanced:last-child {
  margin-bottom: 0;
}

.form-input-enhanced {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.2s ease;
  background: white;
}

.form-input-enhanced:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  transform: translateY(-1px);
}

.form-input-enhanced:hover {
  border-color: #cbd5e1;
}

/* ===== è¡¨å•è¡Œå¢å¼º ===== */
.form-row-enhanced {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 16px;
}

/* ===== é€‰æ‹©æ¡†å¢å¼º ===== */
.select-wrapper {
  position: relative;
  display: inline-block;
  width: 100%;
}

.form-select-enhanced {
  width: 100%;
  padding: 12px 40px 12px 16px;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  background: white;
  cursor: pointer;
  transition: all 0.2s ease;
  appearance: none;
}

.form-select-enhanced:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.select-icon {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: #6b7280;
  pointer-events: none;
  transition: transform 0.2s ease;
}

.select-wrapper:hover .select-icon {
  transform: translateY(-50%) rotate(180deg);
}

/* ===== ä¿æŠ¤è®¾ç½®å¡ç‰‡ ===== */
.protection-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.protection-card:hover {
  border-color: #667eea;
  background: #f1f5f9;
}

.protection-info {
  flex: 1;
}

.protection-title {
  margin: 0 0 4px 0;
  font-size: 14px;
  font-weight: 600;
  color: #1f2937;
}

.protection-desc {
  margin: 0;
  font-size: 12px;
  color: #6b7280;
}

/* ===== åˆ‡æ¢å¼€å…³ç»„ä»¶ ===== */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 24px;
  cursor: pointer;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #cbd5e1;
  transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

input:checked + .toggle-slider {
  background: linear-gradient(135deg, #667eea, #764ba2);
}

input:checked + .toggle-slider:before {
  transform: translateX(24px);
}

/* ===== å†…å®¹ç¼–è¾‘å™¨å¢å¼º ===== */
.content-editor-wrapper {
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
  background: white;
  transition: border-color 0.2s ease;
}

.content-editor-wrapper:focus-within {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.editor-toolbar {
  background: #f8fafc;
  border-bottom: 1px solid #e2e8f0;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.toolbar-group {
  display: flex;
  gap: 4px;
}

.toolbar-btn {
  width: 32px;
  height: 32px;
  border: none;
  background: transparent;
  border-radius: 6px;
  color: #6b7280;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  font-size: 14px;
}

.toolbar-btn:hover {
  background: #e2e8f0;
  color: #374151;
  transform: scale(1.05);
}

.toolbar-btn.active {
  background: #667eea;
  color: white;
}

.editor-container {
  position: relative;
  display: flex;
}

.form-textarea-enhanced {
  flex: 1;
  border: none;
  padding: 20px;
  font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', monospace;
  font-size: 14px;
  line-height: 1.6;
  resize: none;
  background: transparent;
  color: #1f2937;
  min-height: 400px;
  outline: none;
}

.form-textarea-enhanced::placeholder {
  color: #9ca3af;
  font-style: italic;
}

.editor-footer {
  background: #f8fafc;
  border-top: 1px solid #e2e8f0;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.editor-stats {
  display: flex;
  gap: 16px;
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: #6b7280;
}

.stat-item i {
  font-size: 10px;
}

.editor-actions {
  display: flex;
  gap: 8px;
}

.btn-ghost {
  background: transparent;
  color: #6b7280;
  border: 1px solid #e2e8f0;
}

.btn-ghost:hover {
  background: #f3f4f6;
  color: #374151;
  border-color: #d1d5db;
}

.btn-outline {
  background: transparent;
  color: #667eea;
  border: 1px solid #667eea;
}

.btn-outline:hover {
  background: #667eea;
  color: white;
}

/* ===== æŒ‰é’®å¢å¼º ===== */
.modal-footer-enhanced {
  background: #f8fafc;
  padding: 20px 24px;
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  border-top: 1px solid #e2e8f0;
}

.btn-enhanced {
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 500;
  font-size: 14px;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.btn-enhanced:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn-enhanced:active {
  transform: translateY(0);
}

.btn-loading-capable {
  min-width: 140px;
}

.btn-content,
.btn-loading {
  display: flex;
  align-items: center;
  gap: 8px;
  justify-content: center;
}

/* ===== å†…å®¹ç±»å‹é€‰æ‹©å™¨å¢å¼º ===== */
.content-type-selector {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

.type-option {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  background: #f8fafc;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.type-option:hover {
  border-color: #667eea;
  background: #f1f5f9;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}

.type-option.selected {
  border-color: #667eea;
  background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.type-option.selected::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(135deg, #667eea, #764ba2);
}

.type-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
  transition: all 0.2s ease;
}

.html-icon {
  background: linear-gradient(135deg, #ff6b35, #f7931e);
  color: white;
}

.markdown-icon {
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  color: white;
}

.svg-icon {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
}

.mermaid-icon {
  background: linear-gradient(135deg, #ec4899, #be185d);
  color: white;
}

.type-info {
  flex: 1;
}

.type-title {
  margin: 0 0 4px 0;
  font-size: 16px;
  font-weight: 600;
  color: #1f2937;
}

.type-desc {
  margin: 0;
  font-size: 12px;
  color: #6b7280;
  line-height: 1.4;
}

.type-check {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: #e5e7eb;
  color: #9ca3af;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  transition: all 0.2s ease;
  flex-shrink: 0;
}

.type-option.selected .type-check {
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  transform: scale(1.1);
}

.type-option:hover .type-icon {
  transform: scale(1.05);
}

.type-option.selected .type-icon {
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .content-type-selector {
    grid-template-columns: 1fr;
    gap: 8px;
  }
  
  .type-option {
    padding: 12px;
  }
  
  .type-icon {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }
  
  .type-title {
    font-size: 14px;
  }
  
  .type-desc {
    font-size: 11px;
  }
}

/* JavaScriptäº¤äº’å¢å¼º */
.type-option[data-value] {
  user-select: none;
}

.type-option.selecting {
  transform: scale(0.98);
}

/* ===== ç»Ÿè®¡æ¦‚è§ˆæ¨ªå‘å¸ƒå±€ - è®¾è®¡å¸ˆé‡æ„ç‰ˆæœ¬ ===== */
.stats-overview {
  margin-bottom: 32px;
}

.stats-container {
  display: grid;
  grid-template-columns: repeat(4, minmax(160px, 1fr));
  gap: 16px;
  align-items: center;
  padding: 24px;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border: 1px solid #e2e8f0;
  border-radius: 16px;
  box-shadow: 
    0 4px 6px -1px rgba(0, 0, 0, 0.1),
    0 2px 4px -1px rgba(0, 0, 0, 0.06);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
  position: relative;
}

.stats-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
}

.stats-container:hover {
  transform: translateY(-2px);
  box-shadow: 
    0 10px 25px -3px rgba(0, 0, 0, 0.1),
    0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 16px;
  flex: 1;
  min-width: 0;
}

.stat-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: white;
  flex-shrink: 0;
  transition: all 0.3s ease;
}

.stat-icon:hover {
  transform: scale(1.1) rotate(5deg);
}

.bg-blue-gradient {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.3);
}

.bg-green-gradient {
  background: linear-gradient(135deg, #10b981, #059669);
  box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.3);
}

.bg-orange-gradient {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  box-shadow: 0 4px 14px 0 rgba(245, 158, 11, 0.3);
}

.bg-purple-gradient {
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
  box-shadow: 0 4px 14px 0 rgba(139, 92, 246, 0.3);
}

.stat-info {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 0;
  flex: 1;
}

.stat-value {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  line-height: 1;
  font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
  letter-spacing: -0.02em;
}

.stat-label {
  font-size: 14px;
  font-weight: 500;
  color: #6b7280;
  white-space: nowrap;
  line-height: 1.2;
}

.stat-divider {
  display: none;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
  .stats-container {
    padding: 20px;
  }
  
  .stat-value {
    font-size: 24px;
  }
  
  .stat-icon {
    width: 40px;
    height: 40px;
    font-size: 18px;
  }
  
  .stat-info {
    gap: 10px;
  }
}

@media (max-width: 768px) {
  .stats-container {
    grid-template-columns: repeat(2, minmax(140px, 1fr));
    gap: 12px;
    padding: 20px;
  }
  
  .stat-item {
    justify-content: center;
    text-align: left;
    width: 100%;
  }
  
  .stat-value {
    font-size: 28px;
  }
  
  .stat-label {
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  .stats-container {
    grid-template-columns: 1fr;
    gap: 12px;
  }
}

/* ===== é¡µé¢ç®¡ç†ä¸“ç”¨æ ·å¼ï¼ˆç²¾ç®€ã€8pxæ …æ ¼ã€å¯¹é½è®¾è®¡ç³»ç»Ÿï¼‰ ===== */
.filter-section {
  margin-bottom: 2rem;
}

.filter-card {
  background: white;
  border-radius: 8px;
  box-shadow: var(--admin-shadow);
  overflow: hidden;
}

.filter-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--admin-border);
  background: #f8fafc;
}

.filter-header h3 {
  margin: 0;
  color: var(--admin-dark);
  font-size: 1rem;
}

.filter-content {
  padding: 1.5rem;
}

.filter-row {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 16px; /* 8pxå€æ•° */
  align-items: end;
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.filter-label {
  font-weight: 500;
  color: var(--admin-secondary);
  font-size: 0.875rem;
}

.page-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.page-name {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.page-id {
  font-size: 0.75rem;
  color: var(--admin-secondary);
  font-family: monospace;
}

.page-content-preview {
  font-size: 0.75rem;
  color: #6b7280;
  max-width: 420px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.type-badge {
  padding: 0.125rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
  text-transform: uppercase;
}

.type-html { background: #dbeafe; color: #1e40af; }
.type-markdown { background: #d1fae5; color: #065f46; }
.type-svg { background: #fef3c7; color: #92400e; }
.type-mermaid { background: #e0e7ff; color: #5b21b6; }

.status-badge {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
}

.status-public { background: #d1fae5; color: #065f46; }
.status-protected { background: #fef3c7; color: #92400e; }

.action-buttons {
  display: flex;
  gap: 0.25rem;
}

.batch-actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  background: #f1f5f9;
  border-radius: 6px;
}

.selected-count {
  font-size: 0.875rem;
  color: var(--admin-secondary);
  margin-left: 0.5rem;
}

.pagination-container {
  margin-top: 1.5rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.pagination {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.page-btn {
  padding: 0.5rem 0.75rem;
  border: 1px solid var(--admin-border);
  background: white;
  color: var(--admin-secondary);
  border-radius: 6px;
  cursor: pointer;
  transition: var(--admin-transition);
  font-size: 0.875rem;
}

.page-btn:hover {
  background: var(--admin-light);
  border-color: var(--admin-primary);
}

.page-btn.active {
  background: var(--admin-primary);
  color: white;
  border-color: var(--admin-primary);
}

.page-ellipsis {
  padding: 0.5rem;
  color: var(--admin-secondary);
}

.pagination-info {
  font-size: 0.875rem;
  color: var(--admin-secondary);
}

.preview-toolbar {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.preview-container {
  border: 1px solid var(--admin-border);
  border-radius: 6px;
  overflow: hidden;
  background: white;
}

.preview-frame {
  width: 100%;
  height: 600px;
  border: none;
  background: white;
}

.page-count {
  color: var(--admin-secondary);
  font-weight: normal;
  font-size: 0.875rem;
}

.btn-link {
  background: none;
  border: none;
  color: var(--admin-secondary);
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 4px;
  transition: var(--admin-transition);
}

.btn-link:hover {
  color: var(--admin-primary);
  background: var(--admin-light);
}

.form-textarea {
  resize: vertical;
  min-height: 300px;
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 0.875rem;
}

@media (max-width: 768px) {
  .filter-row {
    grid-template-columns: 1fr;
  }
  
  .batch-actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .pagination-container {
    flex-direction: column;
    text-align: center;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .page-info {
    min-width: 200px;
  }
}</style>

            </div>
        </main>
    </div>

    <!-- ç§»åŠ¨ç«¯é®ç½© -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- è„šæœ¬æ–‡ä»¶ -->
    <script src="/js/admin-common.js"></script>
</body>
</html> 

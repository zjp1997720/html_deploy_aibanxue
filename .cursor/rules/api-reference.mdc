# API å‚è€ƒæ–‡æ¡£

## ğŸ”— é¡µé¢ç®¡ç† API

### åˆ›å»ºé¡µé¢
```http
POST /api/pages/create
Content-Type: application/json
Authorization: Bearer <API_TOKEN>  # å¯é€‰

{
  "html_content": "<h1>Hello World</h1>",
  "password": "optional_password",
  "code_type": "html"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "id": "abc123",
  "url": "https://yourdomain.com/view/abc123",
  "protected": false
}
```

### è·å–é¡µé¢ä¿¡æ¯
```http
GET /api/pages/:id
Authorization: Bearer <API_TOKEN>  # å¯é€‰
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "id": "abc123",
  "html_content": "<h1>Hello World</h1>",
  "created_at": "2024-01-01T12:00:00.000Z",
  "is_protected": false,
  "code_type": "html"
}
```

### è·å–æœ€è¿‘é¡µé¢åˆ—è¡¨
```http
GET /api/pages/list/recent?limit=10
Authorization: Bearer <API_TOKEN>  # å¿…éœ€
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "pages": [
    {
      "id": "abc123",
      "created_at": "2024-01-01T12:00:00.000Z",
      "is_protected": false,
      "code_type": "html",
      "preview": "Hello World..."
    }
  ]
}
```

## ğŸ” è®¤è¯ç›¸å…³ API

### å¯†ç éªŒè¯
```http
POST /validate-password/:id
Content-Type: application/json

{
  "password": "user_password"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "redirect": "/view/abc123"
}
```

### ç®¡ç†å‘˜ç™»å½•
```http
POST /login
Content-Type: application/x-www-form-urlencoded

password=admin_password
```

## ğŸ–¥ï¸ é¡µé¢è·¯ç”±

### æŸ¥çœ‹é¡µé¢
```http
GET /view/:id
```
- è¿”å›æ¸²æŸ“åçš„HTMLé¡µé¢
- å¦‚æœé¡µé¢å—å¯†ç ä¿æŠ¤ï¼Œæ˜¾ç¤ºå¯†ç è¾“å…¥è¡¨å•
- æ”¯æŒå¤šç§å†…å®¹ç±»å‹ï¼ˆHTMLã€Markdownã€SVGã€Mermaidï¼‰

### ç®¡ç†é¢æ¿
```http
GET /admin/dashboard
```
- éœ€è¦ç®¡ç†å‘˜è®¤è¯
- æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„é¡µé¢åˆ—è¡¨
- æä¾›é¡µé¢ç®¡ç†åŠŸèƒ½

### ä¸»é¡µ
```http
GET /
```
- é¡¹ç›®ä¸»é¡µ
- æ˜¾ç¤ºåˆ›å»ºè¡¨å•å’ŒåŠŸèƒ½ä»‹ç»

## ğŸ“‹ æ”¯æŒçš„å†…å®¹ç±»å‹

### HTML å†…å®¹
```javascript
{
  "html_content": "<div><h1>æ ‡é¢˜</h1><p>å†…å®¹</p></div>",
  "code_type": "html"
}
```

### Markdown å†…å®¹
```javascript
{
  "html_content": "# æ ‡é¢˜\n\nè¿™æ˜¯**Markdown**å†…å®¹",
  "code_type": "markdown"
}
```

### SVG å›¾å½¢
```javascript
{
  "html_content": "<svg>...</svg>",
  "code_type": "svg"
}
```

### Mermaid å›¾è¡¨
```javascript
{
  "html_content": "graph TD\nA-->B",
  "code_type": "mermaid"
}
```

## ğŸ”’ è®¤è¯æ–¹å¼

### API Token è®¤è¯ï¼ˆæ¨èï¼‰
```http
Authorization: Bearer <your_api_token>
```
- è®¾ç½®ç¯å¢ƒå˜é‡ `API_TOKEN`
- é€‚ç”¨äºç¨‹åºåŒ–è®¿é—®

### ä¼šè¯è®¤è¯
- é€šè¿‡ `/login` ç™»å½•è·å¾—ä¼šè¯
- ä½¿ç”¨Cookieç»´æŒè®¤è¯çŠ¶æ€
- é€‚ç”¨äºWebç•Œé¢è®¿é—®

## ğŸ“Š é”™è¯¯å“åº”

### å¸¸è§é”™è¯¯ç 
- **400 Bad Request**ï¼šè¯·æ±‚å‚æ•°é”™è¯¯
- **401 Unauthorized**ï¼šéœ€è¦è®¤è¯
- **403 Forbidden**ï¼šå¯†ç é”™è¯¯æˆ–æƒé™ä¸è¶³
- **404 Not Found**ï¼šé¡µé¢ä¸å­˜åœ¨
- **500 Internal Server Error**ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "error": "Error description",
  "code": "ERROR_CODE"
}
```

## ğŸ”§ å¼€å‘è°ƒè¯•

### å¥åº·æ£€æŸ¥
```http
GET /health
```
**å“åº”ï¼š**
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

### æµ‹è¯•APIï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```bash
# åˆ›å»ºæµ‹è¯•é¡µé¢
curl -X POST http://localhost:5678/api/pages/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_api_token" \
  -d '{"html_content":"<h1>Test</h1>","code_type":"html"}'

# è·å–é¡µé¢
curl http://localhost:5678/api/pages/abc123 \
  -H "Authorization: Bearer your_api_token"
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æ‰£å­æ’ä»¶é›†æˆ
```javascript
// åˆ›å»ºHTMLé¡µé¢å¹¶è¿”å›é“¾æ¥
const createHTMLPage = async (content) => {
  const response = await fetch('/api/pages/create', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${API_TOKEN}`
    },
    body: JSON.stringify({
      html_content: content,
      code_type: 'html'
    })
  });
  
  const result = await response.json();
  return result.url;
};
```

### æ‰¹é‡å¤„ç†
```javascript
// æ‰¹é‡åˆ›å»ºé¡µé¢
const createMultiplePages = async (pages) => {
  const promises = pages.map(page => 
    fetch('/api/pages/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${API_TOKEN}`
      },
      body: JSON.stringify(page)
    })
  );
  
  const responses = await Promise.all(promises);
  return responses.map(r => r.json());
};
```


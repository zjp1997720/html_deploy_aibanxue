# PRD v2.0: 管理后台增强与API Key系统

**版本**: v2.0  
**创建时间**: 2025-01-22  
**负责人**: 产品开发团队  
**开发分支**: `feature/admin-dashboard-enhancement`

---

## 1. 项目背景

### 1.1 现状分析
- HTML-GO项目已实现基础的HTML代码部署功能
- 具备基础的管理员登录和简单dashboard
- 支持多种内容类型（HTML/Markdown/SVG/Mermaid）
- 已实现CI/CD自动部署流程

### 1.2 现存问题
1. **用户体验问题**
   - 管理员页面间无导航，需手动输入URL跳转
   - 缺乏统一的后台管理界面

2. **功能缺失**
   - 无完善的历史记录管理功能
   - 缺少API Key管理系统
   - API接口功能有限，不支持自定义名称

3. **扩展性问题**
   - 无法支持第三方插件集成（如Coze插件）
   - 缺少用户权限和使用统计

---

## 2. 产品目标

### 2.1 核心目标
- 打造完整的管理后台体验，提升管理员操作效率
- 建立API Key管理系统，支持第三方集成
- 增强API功能，支持更多定制化需求

### 2.2 业务价值
- 提升产品易用性，降低管理成本
- 开放API能力，支持插件生态
- 建立用户权限体系，为商业化做准备

---

## 3. 功能需求

### 3.1 管理后台导航系统
**优先级**: P0 (最高)

#### 3.1.1 统一导航栏
- 管理员登录后进入统一的dashboard首页
- 顶部或侧边导航栏，包含以下页面：
  - 📊 概览 (`/admin/dashboard`)
  - 📄 页面管理 (`/admin/pages`)
  - 🔑 API Key管理 (`/admin/apikeys`)
  - ⚙️ 系统设置 (`/admin/settings`)
  - 🚪 退出登录

#### 3.1.2 面包屑导航
- 显示当前页面位置
- 支持快速返回上级页面

### 3.2 完善的页面管理系统
**优先级**: P0 (最高)

#### 3.2.1 页面列表增强
- 分页显示（每页20条记录）
- 支持按以下条件搜索筛选：
  - 页面名称
  - 内容类型（HTML/Markdown/SVG/Mermaid）
  - 创建时间范围
  - 是否受密码保护
  - 使用的API Key

#### 3.2.2 页面操作功能
- 查看页面详情和统计信息
- 编辑页面内容和名称
- 修改密码保护设置
- 批量删除操作
- 复制页面链接
- 二维码生成

#### 3.2.3 统计信息
- 每个页面的访问次数
- 创建时间和最后访问时间
- 页面大小统计

### 3.3 API Key管理系统
**优先级**: P0 (最高)

#### 3.3.1 Key生成和管理
- 创建API Key，支持自定义名称和描述
- 设置使用限制：
  - 最大使用次数（可设置无限制）
  - 过期时间
  - 允许的操作权限
- 查看Key列表，显示创建时间、使用情况、状态

#### 3.3.2 权限控制
- 创建页面权限
- 查看页面权限
- 删除页面权限（可选）

#### 3.3.3 使用统计
- 每个Key的使用次数和频率
- 最近使用时间
- 使用该Key创建的页面列表
- 使用趋势图表（可选）

### 3.4 API功能增强
**优先级**: P0 (最高)

#### 3.4.1 页面名称支持
- `POST /api/pages/create` 接口增加 `name` 参数
- 支持自定义页面名称，默认为 "Untitled"
- 名称显示在管理后台和页面标题中

#### 3.4.2 API Key认证
- 所有API接口支持通过Header传递API Key：
  ```
  Authorization: Bearer <api_key>
  # 或
  X-API-Key: <api_key>
  ```
- 验证Key有效性、权限和使用限制
- 记录API调用日志

#### 3.4.3 增强的响应格式
```json
{
  "success": true,
  "data": {
    "id": "abc123",
    "name": "我的HTML页面",
    "url": "https://yourdomain.com/view/abc123",
    "protected": false,
    "code_type": "html",
    "created_at": "2025-01-22T10:00:00Z"
  },
  "usage": {
    "api_key_used": "key_name",
    "remaining_uses": 99
  }
}
```

### 3.5 Coze插件支持
**优先级**: P1 (高)

#### 3.5.1 插件API规范
- 标准化的请求和响应格式
- 错误处理和状态码
- 支持批量操作（可选）

#### 3.5.2 使用流程
1. 管理员在后台生成API Key
2. 将Key提供给插件用户
3. 用户在Coze插件中配置API Key
4. 插件调用API创建页面，返回访问URL

---

## 4. 用户故事

### 4.1 管理员用户故事
```
作为管理员，
我希望登录后能看到统一的导航界面，
这样我就能快速在不同管理功能间切换，而不需要记住各种URL。
```

```
作为管理员，
我希望能在页面管理界面中搜索和筛选历史页面，
这样我就能快速找到特定的页面进行管理。
```

```
作为管理员，
我希望能生成和管理API Key，
这样我就能控制谁可以使用我的服务，并监控使用情况。
```

### 4.2 API用户故事
```
作为插件开发者，
我希望API支持自定义页面名称，
这样用户就能创建有意义名称的页面。
```

```
作为插件用户，
我希望通过API Key就能使用服务，
这样我就不需要复杂的认证流程。
```

---

## 5. 界面设计要求

### 5.1 设计原则
- 简洁明了，符合现代Web应用设计标准
- 响应式设计，支持移动端访问
- 保持与现有页面风格一致

### 5.2 导航设计
- 顶部导航栏或左侧边栏
- 清晰的图标和文字标识
- 当前页面高亮显示

### 5.3 表格和列表
- 支持排序、搜索、分页
- 操作按钮统一样式
- 加载状态和空状态显示

---

## 6. 技术约束

### 6.1 技术栈保持不变
- Node.js + Express.js
- SQLite数据库
- EJS模板引擎
- 现有的中间件和工具函数

### 6.2 兼容性要求
- 不破坏现有API的向后兼容性
- 新功能渐进增强，不影响现有用户

### 6.3 性能要求
- 管理页面加载时间 < 2秒
- API响应时间 < 500ms
- 支持并发API调用

---

## 7. 验收标准

### 7.1 功能验收
- [ ] 管理员能通过导航在各页面间无缝切换
- [ ] 页面管理功能完整可用（CRUD + 搜索筛选）
- [ ] API Key管理功能完整可用（生成、配置、监控）
- [ ] API接口支持名称参数和Key认证
- [ ] 所有功能在Chrome、Firefox、Safari浏览器正常工作

### 7.2 用户体验验收
- [ ] 导航直观易用，无需学习成本
- [ ] 页面加载流畅，无明显延迟
- [ ] 错误提示清晰有用
- [ ] 移动端基本可用

### 7.3 技术验收
- [ ] 代码质量符合项目规范
- [ ] 新增功能有基本的错误处理
- [ ] 数据库操作使用事务保证一致性
- [ ] API文档更新完整

---

## 8. 风险与mitigation

### 8.1 技术风险
- **风险**: 数据库Schema变更可能影响现有数据
- **缓解**: 提供数据迁移脚本，在测试环境充分验证

### 8.2 用户体验风险
- **风险**: 新导航可能让现有用户困惑
- **缓解**: 保留原有URL可访问，新导航作为增强功能

### 8.3 安全风险
- **风险**: API Key管理不当可能导致权限泄露
- **缓解**: 实现适当的权限控制和使用监控

---

## 9. 发布计划

### Phase 1: 基础功能 (Week 1-2)
- 统一导航系统
- 基础的API Key生成和管理
- API名称参数支持

### Phase 2: 完善功能 (Week 3-4)
- 页面管理增强（搜索、筛选、统计）
- API Key权限和限制功能
- 使用统计和监控

### Phase 3: 优化和完善 (Week 5)
- UI/UX优化
- 性能优化
- 文档完善 